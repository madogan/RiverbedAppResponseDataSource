define(["react","@grafana/ui","@grafana/data","@grafana/runtime","lodash"],(function(e,t,n,r,a){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=52)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t){e.exports=r},function(e,t,n){var r=n(11),a=n(29),o=n(30),i=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?a(e):o(e)}},function(e,t,n){var r=n(12),a="object"==typeof self&&self&&self.Object===Object&&self,o=r||a||Function("return this")();e.exports=o},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t){e.exports=a},function(e,t){e.exports=function(e){return e}},function(e,t,n){var r=n(5),a=n(3);e.exports=function(e){if(!a(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(e,t,n){var r=n(6).Symbol;e.exports=r},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(28))},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){var r=n(10),a=n(15);e.exports=function(e){return null!=e&&a(e.length)&&!r(e)}},function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},function(e,t){var n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var r=n(19),a=n(13),o=n(36),i=n(37),s=Object.prototype,u=s.hasOwnProperty,c=r((function(e,t){e=Object(e);var n=-1,r=t.length,c=r>2?t[2]:void 0;for(c&&o(t[0],t[1],c)&&(r=1);++n<r;)for(var l=t[n],p=i(l),h=-1,d=p.length;++h<d;){var f=p[h],m=e[f];(void 0===m||a(m,s[f])&&!u.call(e,f))&&(e[f]=l[f])}return e}));e.exports=c},function(e,t,n){var r=n(9),a=n(20),o=n(22);e.exports=function(e,t){return o(a(e,t,r),e+"")}},function(e,t,n){var r=n(21),a=Math.max;e.exports=function(e,t,n){return t=a(void 0===t?e.length-1:t,0),function(){for(var o=arguments,i=-1,s=a(o.length-t,0),u=Array(s);++i<s;)u[i]=o[t+i];i=-1;for(var c=Array(t+1);++i<t;)c[i]=o[i];return c[t]=n(u),r(e,this,c)}}},function(e,t){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},function(e,t,n){var r=n(23),a=n(35)(r);e.exports=a},function(e,t,n){var r=n(24),a=n(25),o=n(9),i=a?function(e,t){return a(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:o;e.exports=i},function(e,t){e.exports=function(e){return function(){return e}}},function(e,t,n){var r=n(26),a=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=a},function(e,t,n){var r=n(27),a=n(34);e.exports=function(e,t){var n=a(e,t);return r(n)?n:void 0}},function(e,t,n){var r=n(10),a=n(31),o=n(3),i=n(33),s=/^\[object .+?Constructor\]$/,u=Function.prototype,c=Object.prototype,l=u.toString,p=c.hasOwnProperty,h=RegExp("^"+l.call(p).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||a(e))&&(r(e)?h:s).test(i(e))}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(11),a=Object.prototype,o=a.hasOwnProperty,i=a.toString,s=r?r.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),n=e[s];try{e[s]=void 0;var r=!0}catch(e){}var a=i.call(e);return r&&(t?e[s]=n:delete e[s]),a}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t,n){var r,a=n(32),o=(r=/[^.]+$/.exec(a&&a.keys&&a.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!o&&o in e}},function(e,t,n){var r=n(6)["__core-js_shared__"];e.exports=r},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t){var n=Date.now;e.exports=function(e){var t=0,r=0;return function(){var a=n(),o=16-(a-r);if(r=a,o>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},function(e,t,n){var r=n(13),a=n(14),o=n(16),i=n(3);e.exports=function(e,t,n){if(!i(n))return!1;var s=typeof t;return!!("number"==s?a(n)&&o(t,n.length):"string"==s&&t in n)&&r(n[t],e)}},function(e,t,n){var r=n(38),a=n(49),o=n(14);e.exports=function(e){return o(e)?r(e,!0):a(e)}},function(e,t,n){var r=n(39),a=n(40),o=n(42),i=n(43),s=n(16),u=n(45),c=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e),l=!n&&a(e),p=!n&&!l&&i(e),h=!n&&!l&&!p&&u(e),d=n||l||p||h,f=d?r(e.length,String):[],m=f.length;for(var v in e)!t&&!c.call(e,v)||d&&("length"==v||p&&("offset"==v||"parent"==v)||h&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||s(v,m))||f.push(v);return f}},function(e,t){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},function(e,t,n){var r=n(41),a=n(7),o=Object.prototype,i=o.hasOwnProperty,s=o.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(e){return a(e)&&i.call(e,"callee")&&!s.call(e,"callee")};e.exports=u},function(e,t,n){var r=n(5),a=n(7);e.exports=function(e){return a(e)&&"[object Arguments]"==r(e)}},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){(function(e){var r=n(6),a=n(44),o=t&&!t.nodeType&&t,i=o&&"object"==typeof e&&e&&!e.nodeType&&e,s=i&&i.exports===o?r.Buffer:void 0,u=(s?s.isBuffer:void 0)||a;e.exports=u}).call(this,n(17)(e))},function(e,t){e.exports=function(){return!1}},function(e,t,n){var r=n(46),a=n(47),o=n(48),i=o&&o.isTypedArray,s=i?a(i):r;e.exports=s},function(e,t,n){var r=n(5),a=n(15),o=n(7),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&a(e.length)&&!!i[r(e)]}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,n){(function(e){var r=n(12),a=t&&!t.nodeType&&t,o=a&&"object"==typeof e&&e&&!e.nodeType&&e,i=o&&o.exports===a&&r.process,s=function(){try{var e=o&&o.require&&o.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=s}).call(this,n(17)(e))},function(e,t,n){var r=n(3),a=n(50),o=n(51),i=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return o(e);var t=a(e),n=[];for(var s in e)("constructor"!=s||!t&&i.call(e,s))&&n.push(s);return n}},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},function(e,t,n){"use strict";n.r(t);var r=n(2);function a(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))}Object.create;Object.create;var o,i=n(18),s=n.n(i),u=n(4);!function(e){e.ip="IP",e.webApp="Web App",e.hostGroup="Host Group",e.application="Application",e.ssl="SSL",e.alerts="Alerts"}(o||(o={}));var c=[{label:"Application",value:o.application},{label:"Host Group",value:o.hostGroup},{label:"Web App",value:o.webApp},{label:"IP",value:o.ip},{label:"SSL",value:o.ssl},{label:"Alerts",value:o.alerts}],l=[{value:0,label:"Auto"},{value:60,label:"60 seconds"},{value:300,label:"5 minutes"},{value:3600,label:"1 hour"},{value:21600,label:"6 hours"},{value:86400,label:"1 day"}],p=[{label:"Status",value:"status",type:r.FieldType.string},{label:"Subject Common Name",value:"subject.common_name",type:r.FieldType.string},{label:"Subject Organization",value:"subject.organization",type:r.FieldType.string},{label:"Issuer Common Name",value:"issuer.common_name",type:r.FieldType.string},{label:"Issuer Organization",value:"issuer.organization",type:r.FieldType.string},{label:"Valid From",value:"valid_from",type:r.FieldType.time},{label:"Valid To",value:"valid_to",type:r.FieldType.time},{label:"First Seen",value:"first_seen",type:r.FieldType.time},{label:"Last Seen",value:"last_seen",type:r.FieldType.time},{label:"Expiration Time",value:"expiration_time",type:r.FieldType.number}],h=[{name:"Severity",label:"Severity",value:"alert.severity_level_name",type:"string"},{name:"Alert Ongoing",label:"Alert Ongoing",value:"alert.ongoing_name",type:"string"},{name:"Policy Name",label:"Policy Name",value:"alert.policy_name",type:"string"},{name:"Policy Description",label:"Policy Description",value:"alert.policy_description",type:"string"},{name:"Policy Type",label:"Policy Type",value:"alert.policy_type_name",type:"string"},{name:"Alert Violations Preview (Resolved)",label:"Alert Violations Preview (Resolved)",value:"alert.violations_preview_resolved",type:"string"},{name:"Duration",label:"Duration",value:"alert.duration",type:"string"},{name:"Alert Start Time",label:"Start Time",value:"alert.start_time",type:"time"},{name:"Alert End time",label:"Alert End time",value:"alert.end_time",type:"time"}],d={timeshift:0,granularity:l[0],sourceGroup:o.application,top:!1,topN:10,topGraph:!1,sslKeys:[],currentSSLKeyColumns:p,expirationTime:-1,webApps:[],webAppMetrics:[],hostGroups:[],hostGroupMetrics:[],applications:[],applicationMetrics:[],alertLimit:10,alertColumns:h,currentAlertsColumns:h};function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y(e);if(t){var a=y(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return b(this,n)}}function b(e,t){if(t&&("object"===f(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}(p,e);var t,n,i,c=g(p);function p(e){var t,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),(t=c.call(this,e)).data=[],t.sslKeys=[],t.ipMetrics=[],t.topMetrics=[],t.webApps=[],t.webAppMetrics=[],t.hostGroups=[],t.hostGroupMetrics=[],t.applications=[],t.applicationMetrics=[],t.alerts=[],t.alertColumns=[],t.queryTimeout=60,t.optionsTimeout=15,t.settings=e,t.url=t.settings.url||"",t.token=null!==(n=e.jsonData.token)&&void 0!==n?n:"",t.urls={base:t.url+"/base",auth:t.url+"/auth",ssl:t.url+"/ssl",webApp:t.url+"/webapps",metric:t.url+"/aggregates",hostGroup:t.url+"/hostgroups",application:t.url+"/applications",instanceCreationSync:t.url+"/instancecreationsync",alerts:t.url+"/alerts"},t.headers={"Content-Type":"application/json"},t.lastFetchQuery=new Date,t.lastFetchMetrics=new Date,t.lastFetchWebApps=new Date,t.lastFetchWebAppMetrics=new Date,t.lastFetchHostGroups=new Date,t.lastFetchHostGroupMetrics=new Date,t.lastFetchApplications=new Date,t.lastFetchApplicationMetrics=new Date,t.lastFetchIPMetrics=new Date,t.lastFetchSSLKeys=new Date,t.lastFetchAlerts=new Date,t.lastFetchAlertColumns=new Date,t}return t=p,(n=[{key:"topngraphquery",value:function(e,t,n,r){return a(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i,s,u,c,l,p;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(s=[],u=[],s=[{direction:"desc",id:e.currentTopMetric.value}],e.sourceGroup!==o.application){a.next=8;break}u=["app.id","app.name"],i=["start_time","app.id"],a.next=24;break;case 8:if(e.sourceGroup!==o.hostGroup){a.next=13;break}u=["host_group.id","host_group.name"],i=["start_time","host_group.id"],a.next=24;break;case 13:if(e.sourceGroup!==o.webApp){a.next=18;break}u=["app.id","app.name"],i=["start_time","app.id"],a.next=24;break;case 18:if(e.sourceGroup!==o.ip){a.next=23;break}u=["tcp.ip","tcp.dns"],i=["start_time","tcp.ip"],a.next=24;break;case 23:throw new Error("Unknown source group");case 24:return u.push(e.currentTopMetric.value),c=[],l="",a.next=29,this.doRequest({method:"POST",url:this.urls.instanceCreationSync,data:{data_defs:[{source:{name:"aggregates"},time:{start:t.toString(),end:n.toString(),granularity:r.toString()},top_by:s,columns:u,limit:e.topN||10}]}}).then((function(e){var t;t=e.data.data_defs[0].hasOwnProperty("data")?e.data.data_defs[0].data:[];for(var n=0;n<t.length;n++)c.push(t[n][1]),n===t.length-1?l+="'".concat(t[n][0],"'"):l+="'".concat(t[n][0],"', ");return l}));case 29:return u.unshift("start_time"),a.next=32,this.doRequest({method:"POST",url:this.urls.instanceCreationSync,data:{data_defs:[{source:{name:"aggregates"},time:{start:t.toString(),end:n.toString(),granularity:r.toString()},group_by:i,columns:u,filters:[{type:"STEELFILTER",value:"".concat(u[1]," IN (").concat(l,")")}]}]}}).then((function(e){return e.data.data_defs[0].hasOwnProperty("data")?e.data:[]}));case 32:return p=a.sent,a.abrupt("return",{tops:c,result:p});case 34:case"end":return a.stop()}}),a,this)})))}},{key:"query",value:function(e){return a(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,a,i,u,c,p,h,f,m,v,g,b,y=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.range,a=n.to.valueOf(),i=n.from.valueOf(),h={},f={},m=[],g=[],b=e.targets.map((function(e){var t,n,b,w,j,C,S,O=s()(e,d);if(u=new Date(a).getTime()/1e3,c=new Date(i).getTime()/1e3,0===(null==(p=O.granularity)?void 0:p.value)){var E=(u-c)/60;p=E<60?l[1]:E<360?l[2]:E<7200?l[3]:E<86400?l[4]:l[5]}if(h={name:"aggregates"},O.sourceGroup==o.alerts)return y.getAlerts(O.currentAlertsColumns,c,u,null==p?void 0:p.value,O.alertLimit).then((function(e){for(var t,n=[],a=0;a<O.currentAlertsColumns.length;a++)n.push({type:O.currentAlertsColumns[a].type,name:O.currentAlertsColumns[a].label,value:O.currentAlertsColumns[a].value});t=new r.MutableDataFrame({fields:n,name:"Alerts",refId:O.refId});for(var o=0;o<e.length;o++){for(var i=[],s=e[o],u=0;u<n.length;u++)i.push(s[n[u].value]);t.appendRow(i)}return t}));if(O.sourceGroup==o.ssl)return y.getSSLKeys().then((function(e){for(var t,n=[],a=0;a<O.currentSSLKeyColumns.length;a++)n.push({type:O.currentSSLKeyColumns[a].type,name:O.currentSSLKeyColumns[a].label,value:O.currentSSLKeyColumns[a].value});t=new r.MutableDataFrame({fields:n,name:"SSL Keys",refId:O.refId});for(var o=0;o<e.length;o++){var i=[],s=e[o];if(s.valid_from>=new Date(1e3*c)&&s.valid_to<=new Date(1e3*u))if(s.expiration_time=parseInt(((s.valid_to.getTime()-(new Date).getTime())/864e5).toString(),10),O.expirationTime>-1){if(s.expiration_time<O.expirationTime){for(var l=0;l<n.length;l++)i.push(s[n[l].value]);t.appendRow(i)}}else{for(var p=0;p<n.length;p++)i.push(s[n[p].value]);t.appendRow(i)}}return t}));if(O.sourceGroup==o.hostGroup)f=["start_time","host_group.id"],m=["start_time","host_group.id","host_group.name"],g.push({type:"STEELFILTER",value:"host_group.id == "+(null===(t=O.currentHostGroup)||void 0===t?void 0:t.value)}),m.push(null===(n=O.currentHostGroupMetric)||void 0===n?void 0:n.value),v=O.currentHostGroupMetric;else if(O.sourceGroup===o.application)f=["start_time","app.id"],m=["start_time","app.id","app.name"],g.push({type:"STEELFILTER",value:"app.id == "+(null===(b=O.currentApplication)||void 0===b?void 0:b.value)}),m.push(null===(w=O.currentApplicationMetric)||void 0===w?void 0:w.value),v=O.currentApplicationMetric;else if(O.sourceGroup===o.ip)h={name:"aggregates"},f=["start_time"],m=["start_time","tcp.ip","tcp.dns"],g.push({type:"STEELFILTER",value:"tcp.ip == "+O.currentIP}),m.push(null===(j=O.currentIPMetric)||void 0===j?void 0:j.value),v=O.currentIPMetric;else{if(O.sourceGroup!==o.webApp)throw new Error("Unknown source group");f=["start_time","app.id"],m=["start_time","app.id","app.name"],g.push({type:"STEELFILTER",value:"app.id == "+(null===(C=O.currentWebApp)||void 0===C?void 0:C.value)}),m.push(null===(S=O.currentWebAppMetric)||void 0===S?void 0:S.value),v=O.currentWebAppMetric}var x={source:h,time:{end:u.toString(),start:c.toString(),granularity:null==p?void 0:p.value.toString()},group_by:f,columns:m};if(O.top){if(x.limit=O.topN||10,x.top_by=[{id:null==v?void 0:v.value,direction:"desc"}],x.group_by={},x.columns=x.columns.slice(1),O.topGraph)return y.topngraphquery(O,c,u,0).then((function(e){var t,n,a=e.tops,o=e.result.data_defs[0];o.hasOwnProperty("data")||(o.data=[]),n=void 0!==O.alias&&""!==O.alias.trim()?O.alias:null===(t=O.currentTopMetric)||void 0===t?void 0:t.label;for(var i=[{name:"Time",type:r.FieldType.time,values:[]}],s=0;s<a.length;s++)i.push({name:a[s],type:r.FieldType.number,values:[]});for(var u=new r.MutableDataFrame({name:n,fields:i,refId:O.refId}),c=0;c<o.data.length;c++){var l=[],p=o.data[c];l.push(new Date(1e3*p[0]));for(var h=0;h<a.length;h++)a[h]===p[2]?l.push(p[p.length-1]):l.push(null);u.appendRow(l)}return u}))}else x.filters=g;return y.doRequest({url:y.urls.instanceCreationSync,data:{data_defs:[x]},method:"POST"}).then((function(e){var t,n=e.data.data_defs[0];void 0===n.data&&(n.data=[]),t=void 0!==O.alias&&""!==O.alias.trim()?O.alias:null==v?void 0:v.value;var a,o=[];if(O.top){for(var i=[],s=0;s<n.columns.length;s++){var u=n.columns[s];-1===u.search("id")?o.push({name:u,type:r.FieldType.other}):i.push(s)}a=new r.MutableDataFrame({refId:O.refId,name:t,fields:o});for(var c=function(e){i.forEach((function(t){n.data[e].splice(t,1)})),a.appendRow(n.data[e])},l=0;l<n.data.length;l++)c(l)}else{o=[{name:"Time",type:r.FieldType.time},{name:"Value",type:r.FieldType.number}],a=new r.MutableDataFrame({refId:O.refId,name:t,fields:o});for(var p=0;p<n.data.length;p++){var h=n.data[p];a.appendRow([new Date(1e3*h[0]),h[h.length-1]])}}return y.data.push(a),a}))})),t.abrupt("return",Promise.all(b).then((function(e){return{data:e}})));case 9:case"end":return t.stop()}}),t)})))}},{key:"testDatasource",value:function(){return a(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(u.getBackendSrv)().datasourceRequest({method:"POST",url:this.urls.auth,headers:this.headers}).then((function(e){return!0===e.ok?(t.settings.jsonData.token=e.data.access_token,{status:"success",message:"Data source is working"}):{status:"error",message:"Data source is not working"}})).catch((function(e){return{status:"error",message:e.statusText}})));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"doRequest",value:function(e){return a(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(""!==this.settings.jsonData.token&&void 0!==this.settings.jsonData.token&&null!==this.settings.jsonData.token){t.next=5;break}return t.next=5,Object(u.getBackendSrv)().datasourceRequest({method:"POST",url:this.urls.auth}).then((function(e){n.settings.jsonData.token=e.data.access_token}));case 5:return t.abrupt("return",Object(u.getBackendSrv)().datasourceRequest(Object.assign(Object.assign({},e),{headers:Object.assign(Object.assign({},this.headers),{Authorization:"Bearer "+this.settings.jsonData.token})})));case 6:case"end":return t.stop()}}),t,this)})))}},{key:"getHostGroups",value:function(){return a(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],e.prev=2,!((Date.now()-this.lastFetchHostGroups.getTime())/1e3/60<this.optionsTimeout&&this.hostGroups.length>0)){e.next=6;break}return e.abrupt("return",this.hostGroups);case 6:return e.next=8,this.doRequest({method:"GET",url:this.urls.hostGroup}).then((function(e){if(n.hostGroups=[],void 0!==e)for(var r in e.data.items)if(e.data.items[r].enabled){var a={label:e.data.items[r].name,value:e.data.items[r].id};t.push(a),n.hostGroups.push(a)}n.lastFetchHostGroups=new Date(Date.now())}));case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2);case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[2,10]])})))}},{key:"getApplications",value:function(){return a(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],e.prev=1,!((Date.now()-this.lastFetchApplications.getTime())/1e3/60<this.optionsTimeout&&this.applications.length>0)){e.next=5;break}return e.abrupt("return",this.applications);case 5:return e.next=7,this.doRequest({method:"GET",url:this.urls.application}).then((function(e){if(void 0!==e)for(var r in n.applications=[],e.data.items)if(e.data.items[r].enabled){var a={label:e.data.items[r].name,value:e.data.items[r].id};t.push(a),n.applications.push(a)}n.lastFetchApplications=new Date(Date.now())}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1);case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this,[[1,9]])})))}},{key:"getWebApps",value:function(){return a(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],e.prev=1,!((Date.now()-this.lastFetchWebApps.getTime())/1e3/60<this.optionsTimeout&&this.webApps.length>0)){e.next=5;break}return e.abrupt("return",this.webApps);case 5:return e.next=7,this.doRequest({method:"GET",url:this.urls.webApp}).then((function(e){if(void 0!==e)for(var r in n.webApps=[],e.data.items)if(e.data.items[r].enabled){var a={label:e.data.items[r].name,value:e.data.items[r].id};t.push(a),n.webApps.push(a)}n.lastFetchWebApps=new Date(Date.now())}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1);case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this,[[1,9]])})))}},{key:"getTopMetrics",value:function(e){return a(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e!==o.application){t.next=6;break}return t.next=3,this.getApplicationMetrics();case 3:this.topMetrics=t.sent,t.next=25;break;case 6:if(e!==o.hostGroup){t.next=12;break}return t.next=9,this.getHostGroupMetrics();case 9:this.topMetrics=t.sent,t.next=25;break;case 12:if(e!==o.webApp){t.next=18;break}return t.next=15,this.getWebAppMetrics();case 15:this.topMetrics=t.sent,t.next=25;break;case 18:if(e!==o.ip){t.next=24;break}return t.next=21,this.getIPMetrics();case 21:this.topMetrics=t.sent,t.next=25;break;case 24:throw new Error("Unknown source group");case 25:return t.abrupt("return",this.topMetrics);case 26:case"end":return t.stop()}}),t,this)})))}},{key:"getApplicationMetrics",value:function(){return a(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],e.prev=1,!((Date.now()-this.lastFetchApplicationMetrics.getTime())/1e3/60<this.optionsTimeout&&this.applicationMetrics.length>0)){e.next=5;break}return e.abrupt("return",this.applicationMetrics);case 5:return e.next=7,this.doRequest({method:"GET",url:this.urls.metric}).then((function(e){if(void 0!==e)for(var r in n.applicationMetrics=[],e.data.columns){var a=e.data.columns[r].id,o=e.data.columns[r].unit,i=e.data.columns[r].rate,s=e.data.columns[r].label;if(!(a.endsWith(".id")||a.endsWith("_id")||a.endsWith(".id")||a.endsWith(".name")||a.endsWith("_name")||a.endsWith(".ip")||a.endsWith("_ip")||a.endsWith(".url")||a.endsWith("_url")||a.endsWith(".type")||a.endsWith("_type")||a.endsWith(".dns")||a.endsWith("_dns")||a.endsWith("start_time")||a.endsWith("end_time")||a.includes("rtp"))){void 0!==i&&"none"!==o?s="".concat(s," (").concat(o,"/").concat(i,")"):void 0!==i&&(s="".concat(s," (").concat(i,")"));var u={value:a,label:s};a.includes("p2m")||a.includes("m2p")||a.includes("web")||a.includes("_db.")||a.includes("cxa")||(t.push(u),n.applicationMetrics.push(u))}}n.lastFetchApplicationMetrics=new Date(Date.now())}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1);case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this,[[1,9]])})))}},{key:"getIPMetrics",value:function(){return a(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],e.prev=1,!((Date.now()-this.lastFetchIPMetrics.getTime())/1e3/60<this.optionsTimeout&&this.ipMetrics.length>0)){e.next=5;break}return e.abrupt("return",this.ipMetrics);case 5:return e.next=7,this.doRequest({method:"GET",url:this.urls.metric}).then((function(e){if(void 0!==e)for(var r in n.ipMetrics=[],e.data.columns){var a=e.data.columns[r].id,o=e.data.columns[r].unit,i=e.data.columns[r].rate,s=e.data.columns[r].label;if(!(a.endsWith(".id")||a.endsWith("_id")||a.endsWith(".id")||a.endsWith(".name")||a.endsWith("_name")||a.endsWith(".ip")||a.endsWith("_ip")||a.endsWith(".url")||a.endsWith("_url")||a.endsWith(".type")||a.endsWith("_type")||a.endsWith(".dns")||a.endsWith("_dns")||a.endsWith("start_time")||a.endsWith("end_time")||a.includes("rtp"))){void 0!==i&&"none"!==o?s="".concat(s," (").concat(o,"/").concat(i,")"):void 0!==i&&(s="".concat(s," (").concat(i,")"));var u={value:a,label:s};a.includes("p2m")||a.includes("m2p")||a.includes("web")||a.includes("_db.")||a.includes("cxa")||(t.push(u),n.ipMetrics.push(u))}}n.lastFetchIPMetrics=new Date(Date.now())}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1);case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this,[[1,9]])})))}},{key:"getHostGroupMetrics",value:function(){return a(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],e.prev=1,!((Date.now()-this.lastFetchHostGroupMetrics.getTime())/1e3/60<this.optionsTimeout&&this.hostGroupMetrics.length>0)){e.next=5;break}return e.abrupt("return",this.hostGroupMetrics);case 5:return e.next=7,this.doRequest({method:"GET",url:this.urls.metric}).then((function(e){if(void 0!==e)for(var r in n.hostGroupMetrics=[],e.data.columns){var a=e.data.columns[r].id,o=e.data.columns[r].unit,i=e.data.columns[r].rate,s=e.data.columns[r].label;if(!(a.endsWith(".id")||a.endsWith("_id")||a.endsWith(".id")||a.endsWith(".name")||a.endsWith("_name")||a.endsWith(".ip")||a.endsWith("_ip")||a.endsWith(".url")||a.endsWith("_url")||a.endsWith(".type")||a.endsWith("_type")||a.endsWith(".dns")||a.endsWith("_dns")||a.endsWith("start_time")||a.endsWith("end_time")||a.includes("rtp"))){void 0!==i&&"none"!==o?s="".concat(s," (").concat(o,"/").concat(i,")"):void 0!==i&&(s="".concat(s," (").concat(i,")"));var u={value:a,label:s};t.push(u),n.hostGroupMetrics.push(u)}}n.lastFetchHostGroupMetrics=new Date(Date.now())}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1);case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this,[[1,9]])})))}},{key:"getWebAppMetrics",value:function(){return a(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],e.prev=1,!((Date.now()-this.lastFetchWebAppMetrics.getTime())/1e3/60<this.optionsTimeout&&this.webAppMetrics.length>0)){e.next=5;break}return e.abrupt("return",this.webAppMetrics);case 5:return e.next=7,this.doRequest({method:"GET",url:this.urls.metric}).then((function(e){if(void 0!==e)for(var r in n.webAppMetrics=[],e.data.columns){var a=e.data.columns[r].id,o=e.data.columns[r].unit,i=e.data.columns[r].rate,s=e.data.columns[r].label;if(!(a.endsWith(".id")||a.endsWith("_id")||a.endsWith(".id")||a.endsWith(".name")||a.endsWith("_name")||a.endsWith(".ip")||a.endsWith("_ip")||a.endsWith(".url")||a.endsWith("_url")||a.endsWith(".type")||a.endsWith("_type")||a.endsWith(".dns")||a.endsWith("_dns")||a.endsWith("start_time")||a.endsWith("end_time")||a.includes("rtp"))){void 0!==i&&"none"!==o?s="".concat(s," (").concat(o,"/").concat(i,")"):void 0!==i&&(s="".concat(s," (").concat(i,")"));var u={value:a,label:s};a.includes("_web.")&&(t.push(u),n.webAppMetrics.push(u))}}n.lastFetchWebAppMetrics=new Date(Date.now())}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1);case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this,[[1,9]])})))}},{key:"getAlertColumns",value:function(){return a(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],e.prev=2,!((Date.now()-this.lastFetchAlertColumns.getTime())/1e3/60<this.optionsTimeout&&this.alertColumns.length>0)){e.next=6;break}return e.abrupt("return",this.alertColumns);case 6:return e.next=8,this.doRequest({method:"GET",url:this.urls.alerts+"/columns"}).then((function(e){if(void 0!==e)for(var a in n.alertColumns=[],e.data.items){var o=e.data.items[a],i="";i="none"!==o.unit?"".concat(o.label," (").concat(o.unit,")"):o.label;var s={value:o.id,label:o.label,name:i,type:(u=o.type,"timestamp"===u?r.FieldType.time:"integer"===u?r.FieldType.number:r.FieldType.string)};t.push(s),n.alertColumns.push(s)}var u}));case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2);case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[2,10]])})))}},{key:"getAlerts",value:function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10;return a(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i,s=this;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=[],a.prev=4,!((Date.now()-this.lastFetchAlerts.getTime())/1e3<10&&this.alerts.length>0)){a.next=8;break}return a.abrupt("return",this.alerts);case 8:return a.next=11,this.doRequest({method:"POST",url:this.urls.instanceCreationSync,data:{data_defs:[{source:{name:"alert_list"},limit:Number.parseInt(o.toString()),time:{start:t.toString(),end:n.toString(),granularity:r.toString()},columns:e.map((function(e){return e.value}))}]}}).then((function(e){if(void 0!==e)for(var t in s.alerts=[],e.data.data_defs[0].data){for(var n=e.data.data_defs[0].data[t],r={},a=0;a<e.data.data_defs[0].columns.length;a++){var o=n[a],u=e.data.data_defs[0].columns[a];u.includes("time")&&(o=new Date(1e3*Number.parseFloat(o))),r[u]=o}i.push(r),s.alerts.push(r)}s.lastFetchAlerts=new Date(Date.now())}));case 11:a.next=16;break;case 13:a.prev=13,a.t0=a.catch(4);case 16:return a.abrupt("return",i);case 18:case"end":return a.stop()}}),a,this,[[4,13]])})))}},{key:"getSSLKeys",value:function(){return a(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],e.prev=1,!((Date.now()-this.lastFetchSSLKeys.getTime())/1e3/60<this.optionsTimeout&&this.sslKeys.length>0)){e.next=6;break}return e.abrupt("return",this.sslKeys);case 6:return e.next=8,this.doRequest({method:"GET",url:this.urls.ssl}).then((function(e){if(void 0!==e){n.sslKeys=[];for(var r=0;r<e.data.items.length;r++){var a=e.data.items[r],o={status:a.status,"subject.common_name":a.subject.common_name,"subject.organization":a.subject.organization,"issuer.common_name":a.issuer.common_name,"issuer.organization":a.issuer.organization,serial_number:a.serial_number.toString(),valid_from:new Date(1e3*a.valid_from),valid_to:new Date(1e3*a.valid_to),first_seen:new Date(1e3*a.first_seen),last_seen:new Date(1e3*a.last_seen)};t.push(o),n.sslKeys.push(o)}}n.lastFetchSSLKeys=new Date(Date.now())}));case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1);case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[1,10]])})))}}])&&m(t.prototype,n),i&&m(t,i),Object.defineProperty(t,"prototype",{writable:!1}),p}(r.DataSourceApi),j=n(1),C=n(0),S=n.n(C);function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=G(e);if(t){var a=G(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return A(this,n)}}function A(e,t){if(t&&("object"===O(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&T(e,t)}(o,e);var t,n,r,a=M(o);function o(){var e;return E(this,o),(e=a.apply(this,arguments))._onOptionsChange=function(t){var n=e.props,r=n.onOptionsChange,a=n.options;return r(Object.assign(Object.assign({},a),t))},e.onPathChange=function(t){var n=e.props,r=n.onOptionsChange,a=n.options,o=Object.assign(Object.assign({},a.jsonData),{path:t.target.value});r(Object.assign(Object.assign({},a),{jsonData:o}))},e.onTlsSkipVerifyChange=function(t){var n=e.props,r=n.onOptionsChange,a=n.options,o=Object.assign(Object.assign({},a.jsonData),{tlsSkipVerify:t.target.checked,skipTlsVerify:t.target.checked});r(Object.assign(Object.assign({},a),{jsonData:o}))},e.onUsernameChange=function(t){var n=e.props,r=n.onOptionsChange,a=n.options,o=Object.assign(Object.assign({},a.jsonData),{username:t.target.value});r(Object.assign(Object.assign({},a),{jsonData:o}))},e.onPasswordChange=function(t){var n=e.props,r=n.onOptionsChange,a=n.options;r(Object.assign(Object.assign({},a),{secureJsonData:{password:t.target.value}}))},e.onResetPassword=function(){var t=e.props,n=t.onOptionsChange,r=t.options;n(Object.assign(Object.assign({},r),{secureJsonFields:Object.assign(Object.assign({},r.secureJsonFields),{password:!1}),secureJsonData:Object.assign(Object.assign({},r.secureJsonData),{password:""})}))},e}return t=o,(n=[{key:"render",value:function(){var e=this.props.options,t=e.secureJsonFields,n=j.LegacyForms.Input,r=j.LegacyForms.SecretFormField,a=e.secureJsonData||{};return S.a.createElement("div",null,S.a.createElement("div",{className:"gf-form-inline"},S.a.createElement("div",{className:"gf-form"},S.a.createElement(j.InlineFormLabel,{className:"width-10"},"Path"),S.a.createElement("div",{className:"width-10"},S.a.createElement(n,{className:"width-20",value:e.jsonData.path||"",onChange:this.onPathChange})))),S.a.createElement("div",{className:"gf-form-inline"},S.a.createElement("div",{className:"gf-form"},S.a.createElement(j.InlineFormLabel,{className:"width-10"},"User"),S.a.createElement("div",{className:"width-10"},S.a.createElement(n,{className:"width-20",value:e.jsonData.username||"",onChange:this.onUsernameChange})))),S.a.createElement("div",{className:"gf-form-inline"},S.a.createElement("div",{className:"gf-form"},S.a.createElement(r,{isConfigured:t&&t.password,value:a.password||"",label:"Password","aria-label":"Password",labelWidth:10,inputWidth:20,onReset:this.onResetPassword,onChange:this.onPasswordChange}))),S.a.createElement("div",{className:"gf-form-inline"},S.a.createElement("div",{className:"gf-form"},S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{label:"Skip TLS Verify"},S.a.createElement(j.InlineSwitch,{value:e.jsonData.tlsSkipVerify||e.jsonData.skipTlsVerify,checked:e.jsonData.tlsSkipVerify||e.jsonData.skipTlsVerify,onChange:this.onTlsSkipVerifyChange}))))))}}])&&x(t.prototype,n),r&&x(t,r),Object.defineProperty(t,"prototype",{writable:!1}),o}(C.PureComponent),F=n(8);function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function W(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=L(e);if(t){var a=L(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return D(this,n)}}function D(e,t){if(t&&("object"===R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return q(e)}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var N=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&P(e,t)}(s,e);var t,n,r,i=W(s);function s(){var e;return k(this,s),(e=i.apply(this,arguments)).getHostGroups=function(){return a(q(e),void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,n=t.query,r=t.datasource,a=t.onChange,e.next=4,r.getHostGroups();case 4:(o=e.sent).length!==(n.hostGroups.length||0)&&a(Object.assign(Object.assign({},n),{hostGroups:o}));case 6:case"end":return e.stop()}}),e,this)})))},e.getApplications=function(){return a(q(e),void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,n=t.query,r=t.datasource,a=t.onChange,e.next=4,r.getApplications();case 4:(o=e.sent).length!==(n.applications.length||0)&&a(Object.assign(Object.assign({},n),{applications:o}));case 6:case"end":return e.stop()}}),e,this)})))},e.getWebApps=function(){return a(q(e),void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,n=t.query,r=t.datasource,a=t.onChange,e.next=4,r.getWebApps();case 4:(o=e.sent).length!==(n.webApps.length||0)&&a(Object.assign(Object.assign({},n),{webApps:o}));case 6:case"end":return e.stop()}}),e,this)})))},e.getApplicationMetrics=function(){return a(q(e),void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,r=n.query,a=n.datasource,o=n.onChange,e.next=4,a.getApplicationMetrics();case 4:(i=e.sent).length!==((null===(t=r.applicationMetrics)||void 0===t?void 0:t.length)||0)&&o(Object.assign(Object.assign({},r),{applicationMetrics:i}));case 6:case"end":return e.stop()}}),e,this)})))},e.getIPMetrics=function(){return a(q(e),void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,r=n.query,a=n.datasource,o=n.onChange,e.next=4,a.getIPMetrics();case 4:(i=e.sent).length!==((null===(t=r.ipMetrics)||void 0===t?void 0:t.length)||0)&&o(Object.assign(Object.assign({},r),{ipMetrics:i}));case 6:case"end":return e.stop()}}),e,this)})))},e.getHostGroupMetrics=function(){return a(q(e),void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,r=n.query,a=n.datasource,o=n.onChange,e.next=4,a.getHostGroupMetrics();case 4:(i=e.sent).length!==((null===(t=r.hostGroupMetrics)||void 0===t?void 0:t.length)||0)&&o(Object.assign(Object.assign({},r),{hostGroupMetrics:i}));case 6:case"end":return e.stop()}}),e,this)})))},e.getWebAppMetrics=function(){return a(q(e),void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,r=n.query,a=n.datasource,o=n.onChange,e.next=4,a.getWebAppMetrics();case 4:(i=e.sent).length!==((null===(t=r.webAppMetrics)||void 0===t?void 0:t.length)||0)&&o(Object.assign(Object.assign({},r),{webAppMetrics:i}));case 6:case"end":return e.stop()}}),e,this)})))},e.getAlertColumns=function(){return a(q(e),void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,n=t.query,r=t.datasource,a=t.onChange,e.next=4,r.getAlertColumns();case 4:(o=e.sent).length!==(n.alertColumns.length||0)&&a(Object.assign(Object.assign({},n),{alertColumns:o}));case 6:case"end":return e.stop()}}),e,this)})))},e.getTopMetrics=function(){return a(q(e),void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,r=n.query,a=n.datasource,o=n.onChange,e.next=4,a.getTopMetrics(r.sourceGroup);case 4:i=e.sent,r.top&&i.length!==((null===(t=r.topMetrics)||void 0===t?void 0:t.length)||0)&&o(Object.assign(Object.assign({},r),{topMetrics:i}));case 6:case"end":return e.stop()}}),e,this)})))},e.getMetrics=function(){return a(q(e),void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.getApplicationMetrics(),this.getIPMetrics(),this.getHostGroupMetrics(),this.getWebAppMetrics(),this.getTopMetrics();case 6:case"end":return e.stop()}}),e,this)})))},e.getOptions=function(t){t===o.application&&(e.getApplications(),e.getApplicationMetrics()),t===o.hostGroup&&(e.getHostGroups(),e.getHostGroupMetrics()),t===o.webApp&&(e.getWebApps(),e.getWebAppMetrics()),t===o.ip&&e.getIPMetrics(),t===o.alerts&&e.getAlertColumns(),e.getTopMetrics()},e.onSourceGroupChange=function(t){var n=e.props,r=n.onChange,a=n.query,o=n.onRunQuery;t.value!==a.sourceGroup&&(e.getOptions(t.value),r(Object.assign(Object.assign({},a),{sourceGroup:t.value})),o())},e.onHostGroupChange=function(t){var n,r=e.props,a=r.onChange,o=r.query,i=r.onRunQuery;t.value!==(null===(n=o.currentHostGroup)||void 0===n?void 0:n.value)&&(a(Object.assign(Object.assign({},o),{currentHostGroup:t})),i())},e.onApplicationChange=function(t){var n,r=e.props,a=r.onChange,o=r.query,i=r.onRunQuery;t.value!==(null===(n=o.currentApplication)||void 0===n?void 0:n.value)&&(a(Object.assign(Object.assign({},o),{currentApplication:t})),i())},e.onWebAppChange=function(t){var n,r=e.props,a=r.onChange,o=r.query,i=r.onRunQuery;t.value!==(null===(n=o.currentWebApp)||void 0===n?void 0:n.value)&&(a(Object.assign(Object.assign({},o),{currentWebApp:t})),i())},e.onIPChange=function(t){var n=e.props,r=n.onChange,a=n.query,o=n.onRunQuery;r(Object.assign(Object.assign({},a),{currentIP:t.target.value})),o()},e.onApplicationMetricChange=function(t){var n,r=e.props,a=r.onChange,o=r.query,i=r.onRunQuery;t.value!==(null===(n=o.currentApplicationMetric)||void 0===n?void 0:n.value)&&(a(Object.assign(Object.assign({},o),{currentApplicationMetric:t})),i())},e.onHostGroupMetricChange=function(t){var n,r=e.props,a=r.onChange,o=r.query,i=r.onRunQuery;t.value!==(null===(n=o.currentHostGroupMetric)||void 0===n?void 0:n.value)&&(a(Object.assign(Object.assign({},o),{currentHostGroupMetric:t})),i())},e.onWebAppMetricChange=function(t){var n,r=e.props,a=r.onChange,o=r.query,i=r.onRunQuery;t.value!==(null===(n=o.currentWebAppMetric)||void 0===n?void 0:n.value)&&(a(Object.assign(Object.assign({},o),{currentWebAppMetric:t})),i())},e.onIPMetricChange=function(t){var n,r=e.props,a=r.onChange,o=r.query,i=r.onRunQuery;t.value!==(null===(n=o.currentIPMetric)||void 0===n?void 0:n.value)&&(a(Object.assign(Object.assign({},o),{currentIPMetric:t})),i())},e.onExpirationTimeChange=function(t){var n=e.props,r=n.onChange,a=n.query,o=n.onRunQuery;r(Object.assign(Object.assign({},a),{expirationTime:t.target.value})),o()},e.onTopMetricChange=function(t){var n,r=e.props,a=r.onChange,o=r.query,i=r.onRunQuery;t.value!==(null===(n=o.currentTopMetric)||void 0===n?void 0:n.value)&&(a(Object.assign(Object.assign({},o),{currentTopMetric:t})),i())},e.onTopChange=function(t){var n=e.props,r=n.onChange,a=n.query,o=n.onRunQuery;r(Object.assign(Object.assign({},a),{top:t.currentTarget.checked})),o()},e.onTopGraphChange=function(t){var n=e.props,r=n.onChange,a=n.query,o=n.onRunQuery;r(Object.assign(Object.assign({},a),{topGraph:t.currentTarget.checked})),o()},e.onTopNChange=function(t){var n=e.props,r=n.onChange,a=n.query,o=n.onRunQuery;r(Object.assign(Object.assign({},a),{topN:Object(F.toInteger)(t.currentTarget.value)})),o()},e.onAliasChange=function(t){var n=e.props,r=n.onChange,a=n.query,o=n.onRunQuery;r(Object.assign(Object.assign({},a),{alias:t.target.value})),o()},e.onTimeshiftChange=function(t){var n=e.props,r=n.onChange,a=n.query,o=n.onRunQuery;r(Object.assign(Object.assign({},a),{timeshift:t.target.value})),o()},e.onGranularityChange=function(t){var n=e.props,r=n.query,a=n.onChange,o=n.onRunQuery;a(Object.assign(Object.assign({},r),{granularity:t})),o()},e.onSSLColumnsChange=function(t){var n=e.props,r=n.onChange,a=n.query,o=n.onRunQuery;r(Object.assign(Object.assign({},a),{currentSSLKeyColumns:t})),o()},e.onAlertsColumnsChange=function(t){var n=e.props,r=n.onChange,a=n.query,o=n.onRunQuery;r(Object.assign(Object.assign({},a),{currentAlertsColumns:t})),o()},e.onAlertLimitChange=function(t){var n=e.props,r=n.onChange,a=n.query,o=n.onRunQuery;r(Object.assign(Object.assign({},a),{alertLimit:t.target.value})),o()},e}return t=s,(n=[{key:"render",value:function(){var e,t,n,r,a=this,i=Object(F.defaults)(this.props.query,d);return this.getOptions(i.sourceGroup),S.a.createElement("div",{style:{width:"100%"}},S.a.createElement("div",{style:i.sourceGroup===o.hostGroup?{display:"block"}:{display:"none"}},S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{label:"Source Group"},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,options:c,value:i.sourceGroup,onChange:this.onSourceGroupChange})),S.a.createElement("div",{style:i.top?{display:"none"}:{display:"block"}},S.a.createElement(j.InlineField,{label:i.sourceGroup,onLoadStart:this.getHostGroups},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,value:i.currentHostGroup,options:i.hostGroups,onChange:this.onHostGroupChange}))),S.a.createElement(j.InlineField,{label:"Metric",onLoadStart:function(){return a.getHostGroupMetrics()}},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,options:i.hostGroupMetrics,value:i.currentHostGroupMetric,onChange:this.onHostGroupMetricChange}))),S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{label:"Top"},S.a.createElement("div",{style:{marginTop:"8px"}},S.a.createElement(j.Switch,{value:i.top,checked:i.top,onChange:this.onTopChange}))),S.a.createElement(j.InlineField,{disabled:!i.top,label:"N"},S.a.createElement(j.Input,{disabled:!i.top,width:16,value:i.topN||0,onChange:this.onTopNChange})),S.a.createElement(j.InlineField,{disabled:!i.top,label:"Graph"},S.a.createElement("div",{style:{marginTop:"8px"}},S.a.createElement(j.Switch,{disabled:!i.top,value:i.topGraph,checked:i.topGraph,onChange:this.onTopGraphChange}))),S.a.createElement(j.InlineField,{disabled:!(i.top&&i.topGraph),label:"Top Metric",onLoadStart:function(){return a.getTopMetrics()}},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,options:i.topMetrics,value:i.currentTopMetric,onChange:this.onTopMetricChange,disabled:!(i.top&&i.topGraph)}))),S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{label:"Granularity"},S.a.createElement(j.Select,{menuShouldPortal:!0,value:null===(e=i.granularity)||void 0===e?void 0:e.value,options:l,onChange:this.onGranularityChange})),S.a.createElement(j.InlineField,{label:"Alias"},S.a.createElement(j.Input,{value:i.alias||"",onChange:this.onAliasChange})))),S.a.createElement("div",{style:i.sourceGroup===o.application?{display:"block"}:{display:"none"}},S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{label:"Source Group"},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,options:c,value:i.sourceGroup,onChange:this.onSourceGroupChange})),S.a.createElement("div",{style:i.top?{display:"none"}:{display:"block"}},S.a.createElement(j.InlineField,{label:i.sourceGroup,onLoadStart:this.getApplications},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,value:i.currentApplication,options:i.applications,onChange:this.onApplicationChange}))),S.a.createElement(j.InlineField,{label:"Metric",onLoadStart:function(){return a.getApplicationMetrics()}},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,options:i.applicationMetrics,value:i.currentApplicationMetric,onChange:this.onApplicationMetricChange}))),S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{label:"Top"},S.a.createElement("div",{style:{marginTop:"8px"}},S.a.createElement(j.Switch,{value:i.top,checked:i.top,onChange:this.onTopChange}))),S.a.createElement(j.InlineField,{disabled:!i.top,label:"N"},S.a.createElement(j.Input,{disabled:!i.top,width:16,value:i.topN||0,onChange:this.onTopNChange})),S.a.createElement(j.InlineField,{disabled:!i.top,label:"Graph"},S.a.createElement("div",{style:{marginTop:"8px"}},S.a.createElement(j.Switch,{disabled:!i.top,value:i.topGraph,checked:i.topGraph,onChange:this.onTopGraphChange}))),S.a.createElement(j.InlineField,{disabled:!(i.top&&i.topGraph),label:"Top Metric",onLoadStart:function(){return a.getTopMetrics()}},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,options:i.topMetrics,value:i.currentTopMetric,onChange:this.onTopMetricChange,disabled:!(i.top&&i.topGraph)}))),S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{label:"Granularity"},S.a.createElement(j.Select,{menuShouldPortal:!0,value:null===(t=i.granularity)||void 0===t?void 0:t.value,options:l,onChange:this.onGranularityChange})),S.a.createElement(j.InlineField,{label:"Alias"},S.a.createElement(j.Input,{value:i.alias||"",onChange:this.onAliasChange})))),S.a.createElement("div",{style:i.sourceGroup===o.webApp?{display:"block"}:{display:"none"}},S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{label:"Source Group"},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,options:c,value:i.sourceGroup,onChange:this.onSourceGroupChange})),S.a.createElement("div",{style:i.top?{display:"none"}:{display:"block"}},S.a.createElement(j.InlineField,{label:i.sourceGroup,onLoadStart:this.getWebApps},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,value:i.currentWebApp,options:i.webApps,onChange:this.onWebAppChange}))),S.a.createElement(j.InlineField,{label:"Metric",onLoadStart:function(){return a.getWebAppMetrics()}},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,options:i.webAppMetrics,value:i.currentWebAppMetric,onChange:this.onWebAppMetricChange}))),S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{label:"Top"},S.a.createElement("div",{style:{marginTop:"8px"}},S.a.createElement(j.Switch,{value:i.top,checked:i.top,onChange:this.onTopChange}))),S.a.createElement(j.InlineField,{disabled:!i.top,label:"N"},S.a.createElement(j.Input,{disabled:!i.top,width:16,value:i.topN||0,onChange:this.onTopNChange})),S.a.createElement(j.InlineField,{disabled:!i.top,label:"Graph"},S.a.createElement("div",{style:{marginTop:"8px"}},S.a.createElement(j.Switch,{disabled:!i.top,value:i.topGraph,checked:i.topGraph,onChange:this.onTopGraphChange}))),S.a.createElement(j.InlineField,{disabled:!(i.top&&i.topGraph),label:"Top Metric",onLoadStart:function(){return a.getTopMetrics()}},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,options:i.topMetrics,value:i.currentTopMetric,onChange:this.onTopMetricChange,disabled:!(i.top&&i.topGraph)}))),S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{label:"Granularity"},S.a.createElement(j.Select,{menuShouldPortal:!0,value:null===(n=i.granularity)||void 0===n?void 0:n.value,options:l,onChange:this.onGranularityChange})),S.a.createElement(j.InlineField,{label:"Alias"},S.a.createElement(j.Input,{value:i.alias||"",onChange:this.onAliasChange})))),S.a.createElement("div",{style:i.sourceGroup===o.ip?{display:"block"}:{display:"none"}},S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{label:"Source Group"},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,options:c,value:i.sourceGroup,onChange:this.onSourceGroupChange})),S.a.createElement("div",{style:i.top?{display:"none"}:{display:"block"}},S.a.createElement(j.InlineField,{label:i.sourceGroup},S.a.createElement(j.Input,{value:i.currentIP,onChange:this.onIPChange}))),S.a.createElement(j.InlineField,{label:"Metric",onLoadStart:function(){return a.getIPMetrics()}},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,options:i.ipMetrics,value:i.currentIPMetric,onChange:this.onIPMetricChange}))),S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{disabled:!i.top,label:"Top"},S.a.createElement("div",{style:{marginTop:"8px"}},S.a.createElement(j.Switch,{value:i.top,checked:i.top,onChange:this.onTopChange}))),S.a.createElement(j.InlineField,{disabled:!i.top,label:"N"},S.a.createElement(j.Input,{disabled:!i.top,width:16,value:i.topN||0,onChange:this.onTopNChange})),S.a.createElement(j.InlineField,{disabled:!i.top,label:"Graph"},S.a.createElement("div",{style:{marginTop:"8px"}},S.a.createElement(j.Switch,{disabled:!i.top,value:i.topGraph,checked:i.topGraph,onChange:this.onTopGraphChange}))),S.a.createElement(j.InlineField,{disabled:!(i.top&&i.topGraph),label:"Top Metric",onLoadStart:function(){return a.getTopMetrics()}},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,options:i.topMetrics,value:i.currentTopMetric,onChange:this.onTopMetricChange,disabled:!(i.top&&i.topGraph)}))),S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{label:"Granularity"},S.a.createElement(j.Select,{menuShouldPortal:!0,value:null===(r=i.granularity)||void 0===r?void 0:r.value,options:l,onChange:this.onGranularityChange})),S.a.createElement(j.InlineField,{label:"Alias"},S.a.createElement(j.Input,{value:i.alias||"",onChange:this.onAliasChange})))),S.a.createElement("div",{style:i.sourceGroup===o.ssl?{display:"block"}:{display:"none"}},S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{label:"Source Group"},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,options:c,value:i.sourceGroup,onChange:this.onSourceGroupChange})),S.a.createElement(j.InlineField,{label:"If expiration time is less than",tooltip:"Write -1 for all"},S.a.createElement(j.Input,{value:i.expirationTime,onChange:this.onExpirationTimeChange}))),S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{label:"Columns"},S.a.createElement(j.MultiSelect,{width:"auto",menuShouldPortal:!0,options:p,value:i.currentSSLKeyColumns,onChange:this.onSSLColumnsChange})))),S.a.createElement("div",{style:i.sourceGroup===o.alerts?{display:"block"}:{display:"none"}},S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{label:"Source Group"},S.a.createElement(j.Select,{width:"auto",menuShouldPortal:!0,options:c,value:i.sourceGroup,onChange:this.onSourceGroupChange})),S.a.createElement(j.InlineField,{label:"Limit",tooltip:"Max. number of alert to get"},S.a.createElement(j.Input,{value:i.alertLimit,onChange:this.onAlertLimitChange}))),S.a.createElement(j.InlineFieldRow,null,S.a.createElement(j.InlineField,{label:"Columns"},S.a.createElement(j.MultiSelect,{width:"auto",menuShouldPortal:!0,options:i.alertColumns,value:i.currentAlertsColumns,onChange:this.onAlertsColumnsChange})))))}}])&&I(t.prototype,n),r&&I(t,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(C.PureComponent);n.d(t,"plugin",(function(){return H}));var H=new r.DataSourcePlugin(w).setConfigEditor(_).setQueryEditor(N)}])}));
//# sourceMappingURL=module.js.map